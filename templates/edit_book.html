<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTVHS Portal - Edit Book</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_library.css') }}">
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="NTVHS Logo">
            <div class="brand-info">
                <h1>NTVHS Portal</h1>
                <p>Technical ‚Ä¢ Vocational ‚Ä¢ National</p>
            </div>
        </div>

        <div class="nav-section">
            <a href="{{ url_for('library_books') }}" class="back-btn">üìö Library</a>
            <a href="{{ url_for('homepage') }}" class="back-btn">üè† Dashboard</a>
            <a href="{{ url_for('logout') }}" class="logout-btn">üö™ Logout</a>
        </div>
    </div>

    <div class="main-content">
        <!-- Display flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="page-title">
            <h2>‚úèÔ∏è Edit Book</h2>
            <p>Update book information and settings</p>
        </div>

        <div class="upload-container">
            <div class="upload-form">
                <h3 style="text-align: center; margin-bottom: 1.5rem; color: #333;">üìù Edit: {{ book.title }}</h3>

                <!-- Book Preview -->
                <div class="book-preview" style="margin-bottom: 2rem; display: flex; gap: 2rem; align-items: flex-start;">
                    <div style="flex: 1;">
                        {% if book.picture_filename %}
                            <div style="text-align: center; margin-bottom: 1rem;">
                                <img src="{{ url_for('static', filename='library/pictures/' + book.picture_filename) }}"
                                     alt="{{ book.title }}"
                                     style="max-width: 200px; max-height: 250px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            </div>
                        {% else %}
                            <div style="text-align: center; margin-bottom: 1rem; padding: 2rem; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                                <div style="font-size: 3rem; margin-bottom: 0.5rem; opacity: 0.5;">üìö</div>
                                <div style="color: #6c757d;">No Picture</div>
                            </div>
                        {% endif %}
                    </div>

                    <div style="flex: 1;">
                        <div style="text-align: center;">
                            <h4 style="color: #333; margin-bottom: 1rem;">üìÑ PDF Preview</h4>
                            <iframe src="{{ url_for('static', filename='library/pdfs/' + book.pdf_filename) }}"
                                    width="100%" height="300"
                                    style="border: 1px solid #dee2e6; border-radius: 8px;">
                            </iframe>
                            <div style="margin-top: 1rem;">
                                <a href="{{ url_for('download_book', book_id=book.id) }}"
                                   style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px;">
                                    üì• Download PDF
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <form action="{{ url_for('update_book', book_id=book.id) }}" method="POST">
                    <div class="form-group">
                        <label for="title">Title of Book:</label>
                        <input type="text" id="title" name="title" value="{{ book.title }}" required placeholder="Enter book title">
                    </div>

                    <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea id="description" name="description" rows="4" placeholder="Enter book description, summary, or learning objectives...">{{ book.description or '' }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="grade">Grade:</label>
                        <select id="grade" name="grade" required>
                            <option value="">Select Grade Level</option>
                            <option value="Grade 7" {% if book.grade == 'Grade 7' %}selected{% endif %}>Grade 7</option>
                            <option value="Grade 8" {% if book.grade == 'Grade 8' %}selected{% endif %}>Grade 8</option>
                            <option value="Grade 9" {% if book.grade == 'Grade 9' %}selected{% endif %}>Grade 9</option>
                            <option value="Grade 10" {% if book.grade == 'Grade 10' %}selected{% endif %}>Grade 10</option>
                            <option value="Grade 11" {% if book.grade == 'Grade 11' %}selected{% endif %}>Grade 11</option>
                            <option value="Grade 12" {% if book.grade == 'Grade 12' %}selected{% endif %}>Grade 12</option>
                            <option value="ALS 11" {% if book.grade == 'ALS 11' %}selected{% endif %}>ALS 11</option>
                            <option value="ALS 12" {% if book.grade == 'ALS 12' %}selected{% endif %}>ALS 12</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="submit-btn" style="flex: 1;">üíæ Update Book</button>
                        <a href="{{ url_for('library_books') }}" class="submit-btn"
                           style="flex: 1; background: #6c757d; text-align: center; text-decoration: none; display: flex; align-items: center; justify-content: center;">
                           ‚ùå Cancel
                        </a>
                    </div>
                </form>

                <!-- Book Info -->
                <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                    <h4 style="color: #333; margin-bottom: 0.5rem;">üìã Book Information</h4>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.3rem;"><strong>PDF File:</strong> {{ book.pdf_filename }}</p>
                    {% if book.picture_filename %}
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.3rem;"><strong>Picture File:</strong> {{ book.picture_filename }}</p>
                    {% endif %}
                    {% if book.file_size %}
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.3rem;"><strong>Size:</strong> {{ "%.1f"|format(book.file_size / 1024 / 1024) }} MB</p>
                    {% endif %}
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.3rem;"><strong>Uploaded:</strong> {{ book.created_at }}</p>
                    {% if book.updated_at %}
                        <p style="color: #666; font-size: 0.9rem;"><strong>Last Updated:</strong> {{ book.updated_at }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html>