<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTVHS Portal - Manage Quizzes</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_activity_quizzes_worksheets.css') }}">
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="NTVHS Logo">
            <div class="brand-info">
                <h1>NTVHS Portal</h1>
                <p>Technical • Vocational • National</p>
            </div>
        </div>

        <div class="nav-section">
            <a href="{{ url_for('homepage') }}" class="back-btn">🏠 Back to Dashboard</a>
            <a href="{{ url_for('logout') }}" class="logout-btn">🚪 Logout</a>
        </div>
    </div>

    <div class="main-content">
        <!-- Display flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="page-title">
            <h2>📚 Quiz Management</h2>
            <p>Create, manage, and organize quizzes for your students</p>
        </div>

        <div class="content-grid">
            <!-- Add Quiz Form -->
            <div class="form-section">
                <h3>➕ Add New Quiz</h3>
                <form action="{{ url_for('add_quiz') }}" method="POST">
                    <div class="form-group">
                        <label for="name">Name of Quiz:</label>
                        <input type="text" id="name" name="name" required placeholder="Enter quiz name">
                    </div>

                    <div class="form-group">
                        <label for="grade">Grade:</label>
                        <select id="grade" name="grade" required>
                            <option value="">Select Grade Level</option>
                            <option value="Grade 7">Grade 7</option>
                            <option value="Grade 8">Grade 8</option>
                            <option value="Grade 9">Grade 9</option>
                            <option value="Grade 10">Grade 10</option>
                            <option value="Grade 11">Grade 11</option>
                            <option value="Grade 12">Grade 12</option>
                            <option value="ALS 11">ALS 11</option>
                            <option value="ALS 12">ALS 12</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="end_date">Date of End of Activity <span class="optional-label">(Optional)</span>:</label>
                        <input type="datetime-local" id="end_date" name="end_date" placeholder="Select end date and time">
                        <small class="optional-label">Leave empty if no specific end date. Activity will remain active until manually removed.</small>
                    </div>

                    <div class="form-group">
                        <label for="upload_link">Upload Link (Google Form):</label>
                        <input type="url" id="upload_link" name="upload_link" required placeholder="https://forms.google.com/...">
                    </div>

                    <div class="form-group">
                        <label for="professor">Professor <span class="optional-label">(Optional)</span>:</label>
                        <input type="text" id="professor" name="professor" placeholder="Enter professor/teacher name">
                    </div>

                    <button type="submit" class="submit-btn">🚀 Create Quiz</button>
                </form>
            </div>

            <!-- Quiz List -->
            <div class="quiz-list-section">
                <h3>📋 Current Quizzes</h3>
                {% if quizzes %}
                    {% for quiz in quizzes %}
                    <div class="quiz-item">
                        <div class="quiz-header">
                            <div>
                                <div class="quiz-title">{{ quiz.name }}</div>
                                <span class="quiz-grade">{{ quiz.grade }}</span>
                            </div>
                        </div>

                        <div class="quiz-details">
                            {% if quiz.end_date %}
                                <div class="date-highlight">
                                    <span class="date-label">📅 Quiz Expires:</span>
                                    <span class="date-value">{{ quiz.end_date | replace('T', ' at ') }}</span>
                                </div>
                            {% else %}
                                <div class="date-highlight no-expiry">
                                    <span class="date-label">📅 Quiz Duration:</span>
                                    <span class="date-value">No expiration date</span>
                                </div>
                            {% endif %}

                            {% if quiz.professor %}
                                <p><strong>👨‍🏫 Professor:</strong> {{ quiz.professor }}</p>
                            {% endif %}

                            <p><strong>🔗 Quiz Link:</strong> <a href="{{ quiz.upload_link }}" target="_blank" style="color: #667eea;">{{ quiz.upload_link[:50] }}...</a></p>
                            <p><strong>📅 Created:</strong> {{ quiz.created_at }}</p>
                        </div>

                        <div class="quiz-actions">
                            <a href="{{ quiz.upload_link }}" target="_blank" class="btn-small btn-view">👁️ View Quiz</a>
                            <a href="{{ url_for('edit_quiz', quiz_id=quiz.id) }}" class="btn-small btn-edit">✏️ Edit</a>
                            <a href="{{ url_for('delete_quiz', quiz_id=quiz.id) }}"
                               class="btn-small btn-delete"
                               onclick="return confirm('Are you sure you want to delete this quiz?')">🗑️ Delete</a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-quizzes">
                        <p>📝 No quizzes created yet. Use the form on the left to add your first quiz!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>